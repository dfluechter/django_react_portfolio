{% load static %}
<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Portfolio{% endblock %}</title>

    <!-- Tailwind CSS -->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
    <script>
      tailwind.config = { darkMode: 'class' };
    </script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Flowbite -->
    <link
      href="https://unpkg.com/flowbite@2.2.1/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/flowbite@2.2.1/dist/flowbite.min.js"></script>

    <!-- Alpine.js -->
    <script
      defer
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Favicon -->
    <link
      rel="icon"
      href="{% static 'img/favicon.ico' %}"
      type="image/x-icon"
    />
  </head>

  <body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">
    <!-- ğŸ” Header -->
    <header
      class="fixed top-0 left-0 w-full bg-white dark:bg-gray-900 shadow z-50"
      x-data="{ open: false }"
    >
      <div
        class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center"
      >
        <!-- Logo/Home -->
        <a href="{% url 'home' %}" class="text-xl font-bold">
          <i class="fas fa-home"></i>
        </a>

        <!-- ğŸŒ Desktop-Nav -->
        <nav class="hidden md:flex gap-6 items-center text-sm font-medium">
          <a href="/admin/" class="hover:underline">
            <i class="fas fa-tools mr-1"></i> Admin
          </a>
          <a href="{% url 'project_list' %}" class="hover:underline">
            <i class="fas fa-folder-open mr-1"></i> Projekte
          </a>
          <a href="{% url 'certificate_list' %}" class="hover:underline">
            <i class="fas fa-certificate mr-1"></i> Zertifikate
          </a>
          <a href="{% url 'cv' %}" class="hover:underline">
            <i class="fas fa-file-alt mr-1"></i> Lebenslauf
          </a>

          {% if user.is_authenticated %}
          <!-- Dark Mode Toggle -->
          <button
            id="darkModeToggle"
            class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition"
            aria-label="Dark Mode Toggle"
          >
            <i
              id="darkIcon"
              class="fas fa-moon text-gray-700 dark:text-gray-300"
            ></i>
          </button>

          <!-- User Dropdown -->
          <div class="relative">
            <button id="userMenuBtn" class="text-xl">
              <i class="fas fa-user"></i>
            </button>
            <div
              id="userMenu"
              class="absolute right-0 mt-2 w-36 bg-white dark:bg-gray-800 rounded-md shadow-md hidden"
            >
              <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button
                  type="submit"
                  class="block w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700"
                >
                  ğŸšª Logout
                </button>
              </form>
            </div>
          </div>
          {% endif %}
        </nav>

        <!-- ğŸ” Burger -->
        <button
          @click="open = !open"
          class="md:hidden flex flex-col space-y-1 w-8 h-8 justify-center items-center z-50"
        >
          <span
            :class="open ? 'rotate-45 translate-y-1.5' : ''"
            class="w-6 h-0.5 bg-gray-700 dark:bg-white transition-all duration-300 origin-center"
          ></span>
          <span
            :class="open ? 'opacity-0' : ''"
            class="w-6 h-0.5 bg-gray-700 dark:bg-white transition-all duration-300 origin-center"
          ></span>
          <span
            :class="open ? '-rotate-45 -translate-y-1.5' : ''"
            class="w-6 h-0.5 bg-gray-700 dark:bg-white transition-all duration-300 origin-center"
          ></span>
        </button>
      </div>

      <!-- ğŸ“± Slide-in Nav Mobile -->
      <div
        x-show="open"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 -translate-x-full"
        x-transition:enter-end="opacity-100 translate-x-0"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-x-0"
        x-transition:leave-end="opacity-0 -translate-x-full"
        @click.outside="open = false"
        class="md:hidden fixed top-0 left-0 w-full h-screen bg-white dark:bg-gray-900 z-40 flex flex-col items-start justify-center gap-8 px-10"
      >
        <a href="/admin/" class="text-xl hover:underline"> ğŸ›  Admin-Bereich </a>
        <a href="{% url 'project_list' %}" class="text-xl hover:underline">
          ğŸ“ Projekte
        </a>
        <a href="{% url 'certificate_list' %}" class="text-xl hover:underline">
          ğŸ“ Zertifikate
        </a>
        <a href="{% url 'cv' %}" class="text-xl hover:underline">
          ğŸ“„ Lebenslauf
        </a>

        {% if user.is_authenticated %}
        <button
          id="darkModeToggleMobile"
          class="text-xl text-gray-700 dark:text-white"
        >
          <i id="darkIconMobile" class="fas fa-moon"></i>
        </button>

        <form method="post" action="{% url 'logout' %}">
          {% csrf_token %}
          <button
            type="submit"
            class="text-xl text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md"
          >
            ğŸšª Logout
          </button>
        </form>
        {% endif %}
      </div>
    </header>

    <!-- ğŸ’¡ Main -->
    <main class="pt-20 px-4 max-w-7xl mx-auto">
      {% block content %}{% endblock %}
    </main>

    <!-- ğŸ¦¶ Footer -->
    <footer class="py-6 text-center space-x-4">
      <a
        href="https://linkedin.com/in/dfluechter"
        target="_blank"
        title="LinkedIn"
      >
        <i class="fab fa-linkedin fa-2x"></i>
      </a>
      <a href="https://github.com/dfluechter" target="_blank" title="GitHub">
        <i class="fab fa-github fa-2x"></i>
      </a>
      <a href="https://x.com/FluchterDominik" target="_blank" title="X">
        <i class="fab fa-x-twitter fa-2x"></i>
      </a>
      <a
        href="https://www.facebook.com/dominik.fluechter"
        target="_blank"
        title="Facebook"
      >
        <i class="fab fa-facebook fa-2x"></i>
      </a>
      <a href="mailto:dominik.fluechter@googlemail.com" title="E-Mail">
        <i class="fas fa-envelope fa-2x"></i>
      </a>
    </footer>

    <!-- ğŸŒ™â˜€ï¸ Dark Mode Script -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const html = document.documentElement;
        const darkToggle = document.getElementById('darkModeToggle');
        const darkToggleMobile = document.getElementById(
          'darkModeToggleMobile'
        );
        const icon = document.getElementById('darkIcon');
        const iconMobile = document.getElementById('darkIconMobile');

        const applyTheme = (theme) => {
          if (theme === 'dark') {
            html.classList.add('dark');
            icon?.classList.replace('fa-moon', 'fa-sun');
            iconMobile?.classList.replace('fa-moon', 'fa-sun');
          } else {
            html.classList.remove('dark');
            icon?.classList.replace('fa-sun', 'fa-moon');
            iconMobile?.classList.replace('fa-sun', 'fa-moon');
          }
          localStorage.setItem('theme', theme);
        };

        const storedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia(
          '(prefers-color-scheme: dark)'
        ).matches;
        applyTheme(storedTheme || (prefersDark ? 'dark' : 'light'));

        darkToggle?.addEventListener('click', () =>
          applyTheme(html.classList.contains('dark') ? 'light' : 'dark')
        );
        darkToggleMobile?.addEventListener('click', () =>
          applyTheme(html.classList.contains('dark') ? 'light' : 'dark')
        );

        // Avatar dropdown
        const btn = document.getElementById('userMenuBtn');
        const menu = document.getElementById('userMenu');
        btn?.addEventListener('click', () => menu.classList.toggle('hidden'));
      });
    </script>
  </body>
</html>
